<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Toss Tool</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* --- GLOBAL STYLES & PERFORMANCE FIXES --- */

        /* Deep Indigo Background with subtle gradient */
        .deep-indigo-bg {
            background-color: #1a202c; /* Dark base */
            background-image: radial-gradient(at 0% 0%, #374151 0%, transparent 50%), 
                              radial-gradient(at 100% 100%, #1f2937 0%, #1a202c 70%);
        }

        /* Confetti Styles - Optimized for performance */
        @keyframes fall {
          0% { opacity: 1; transform: translate(0, -100px) rotateZ(0deg) rotateX(0deg); }
          100% { opacity: 0; transform: translate(0, 100vh) rotateZ(720deg) rotateX(360deg); } 
        }
        .confetti-wrapper {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          z-index: 1000;
          overflow: hidden;
        }
        .confetti {
          position: absolute;
          animation: fall var(--duration) cubic-bezier(0.25, 0.46, 0.45, 0.94) var(--delay) forwards;
          background-color: var(--color);
          box-shadow: 0 0 5px rgba(0,0,0,0.3);
          left: var(--x);
          top: var(--y);
        }
        
        /* Coin Animation Keyframes */
        @keyframes flip {
          0% { transform: rotateX(0deg) rotateY(0deg); }
          50% { transform: rotateX(180deg) rotateY(180deg); }
          100% { transform: rotateX(360deg) rotateY(360deg); }
        }
        .animate-spin-fast {
          animation: flip 0.1s infinite linear;
        }

        /* Result Bounce Animation */
        @keyframes bounce-custom {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        .animate-bounce-custom {
            animation: bounce-custom 1s;
        }

        /* --- PREMIUM COIN STYLES --- */
        .coin-base {
            background: linear-gradient(45deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
            border: 6px solid #B8860B; /* Thicker, dark gold rim */
            box-shadow: 
                0 0 15px rgba(255, 215, 0, 0.9), /* Stronger glow */
                inset 0 0 30px rgba(255, 255, 255, 0.6), /* Inner shine */
                0 15px 25px rgba(0, 0, 0, 0.7); /* Deeper bottom shadow */
            color: #8B4513; /* Brown text for contrast */
            perspective: 1000px;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        .coin-heads {
            background: linear-gradient(135deg, #FFD700 0%, #FFCC00 50%, #FFD700 100%);
        }
        .coin-tails {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
            transform: rotateY(180deg);
        }
        
        /* --- UTILITY & ANIMATIONS --- */
        @keyframes bounce-in {
            0% { transform: scale(0.5); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-bounce-in {
            animation: bounce-in 0.3s ease-out;
        }
        .text-gray-900 input { color: #1f2937; } 

        /* Custom 3D Button Presets */
        .btn-primary-yellow {
             background-color: #FBBF24; /* Yellow-500 */
             border-bottom: 6px solid #B45309; /* Deep orange for 3D press effect */
        }
        .btn-primary-green {
             background-color: #10B981; /* Emerald-500 */
             border-bottom: 6px solid #065F46; /* Deep teal for 3D press effect */
        }
        .active\:border-b-0:active {
            transform: translateY(3px); /* Shift down on press */
            box-shadow: none; /* Remove shadow on press */
            border-bottom: 3px solid transparent; /* Match button padding when pressed */
        }
        
        /* Card styles */
        .app-card {
            background-color: #ffffff;
            border-radius: 1.5rem; /* 3xl */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); /* Stronger shadow */
            transition: all 0.3s ease-in-out;
        }

        /* Home Button Style */
        .btn-icon-home {
            background-color: #f3f4f6; /* Gray-100 */
            color: #4b5563; /* Gray-600 */
            border: 1px solid #e5e7eb; /* Gray-200 */
        }
        .btn-icon-home:hover {
            background-color: #e5e7eb; /* Gray-200 */
        }
    </style>
</head>
<body class="deep-indigo-bg font-sans text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div id="app" class="w-full max-w-sm sm:max-w-md">
        <!-- Content will be rendered here by JavaScript -->
    </div>

    <footer class="mt-8 text-sm text-gray-400">
        Built by **masternext**
    </footer>

    <div id="confetti-container" class="confetti-wrapper"></div>

    <script>
        // Global State Management
        let appState = {
            mode: null, // 'teams', 'singles', or null
            teamToss: {
                result: null,
                isFlipping: false
            },
            singlesToss: {
                maxNumber: '',
                drawQueue: [],
                drawnNumbers: [],
                isGenerating: false,
                errorMessage: ''
            }
        };

        // --- Core Rendering Function ---
        function renderApp() {
            const app = document.getElementById('app');
            const { mode } = appState;
            
            if (mode === 'teams') {
                app.innerHTML = renderTeamToss();
                attachTeamTossListeners();
            } else if (mode === 'singles') {
                app.innerHTML = renderSinglesToss();
                attachSinglesTossListeners();
            } else {
                app.innerHTML = renderModeSelector();
                attachModeSelectorListeners();
            }
        }

        // --- Confetti Logic (Optimized) ---
        function triggerConfetti() {
            const container = document.getElementById('confetti-container');
            container.innerHTML = ''; 
            
            for (let i = 0; i < 45; i++) {
                const shapeIndex = i % 4;
                let shapeClass = '';
                if (shapeIndex === 0) shapeClass = 'w-3 h-3 rounded-full'; 
                if (shapeIndex === 1) shapeClass = 'w-2 h-4'; 
                if (shapeIndex === 2) shapeClass = 'w-3 h-3'; 
                if (shapeIndex === 3) shapeClass = 'w-4 h-2'; 

                const confettiDiv = document.createElement('div');
                confettiDiv.className = `confetti absolute ${shapeClass}`;
                confettiDiv.style.setProperty('--delay', `${Math.random() * 1.5}s`); 
                confettiDiv.style.setProperty('--color', `hsl(${Math.random() * 360}, 70%, 60%)`); 
                confettiDiv.style.setProperty('--x', `${Math.random() * 100}vw`);
                confettiDiv.style.setProperty('--y', `${Math.random() * -20}vh`); 
                confettiDiv.style.setProperty('--duration', `${2.0 + Math.random() * 1}s`); 
                container.appendChild(confettiDiv);
            }
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000); 
        }

        // --- Mode Selector ---
        function renderModeSelector() {
            return `
                <div class="flex flex-col space-y-5 p-8 app-card border-t-8 border-indigo-600 w-full text-gray-900">
                    <h2 class="text-3xl sm:text-4xl font-extrabold text-gray-900 text-center mb-6 border-b pb-4 border-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="inline w-8 h-8 mr-2 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                        Pro Toss Selector
                    </h2>
                    <button id="select-teams"
                        class="flex items-center justify-center p-4 sm:p-5 text-gray-900 font-black rounded-xl text-lg sm:text-xl shadow-xl transition duration-300 transform hover:scale-[1.01] active:border-b-0 btn-primary-yellow"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2v20M2 12h20"/></svg>
                        Coin Toss (Teams)
                    </button>
                    <button id="select-singles"
                        class="flex items-center justify-center p-4 sm:p-5 text-white font-black rounded-xl text-lg sm:text-xl shadow-xl transition duration-300 transform hover:scale-[1.01] active:border-b-0 btn-primary-green"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M17 18a2 2 0 0 0-2-2H9c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2zM7 2v2M17 2v2M12 2v2"/></svg>
                        Random Number (Singles)
                    </button>
                </div>
            `;
        }
        function attachModeSelectorListeners() {
            document.getElementById('select-teams')?.addEventListener('click', () => {
                appState.mode = 'teams';
                renderApp();
            });
            document.getElementById('select-singles')?.addEventListener('click', () => {
                appState.mode = 'singles';
                renderApp();
            });
        }

        // --- Team Toss Logic ---
        function getCoinClass() {
            const { result, isFlipping } = appState.teamToss;
            if (isFlipping) return 'animate-spin-fast shadow-xl';
            if (result === 'Heads') return 'coin-heads rotate-y-0';
            if (result === 'Tails') return 'coin-tails rotate-y-180';
            return 'coin-base';
        }

        function handleToss() {
            if (appState.teamToss.isFlipping) return;

            appState.teamToss.isFlipping = true;
            appState.teamToss.result = null;
            renderApp(); 

            const finalResult = Math.random() < 0.5 ? 'Heads' : 'Tails';

            setTimeout(() => {
                appState.teamToss.result = finalResult;
                appState.teamToss.isFlipping = false;
                renderApp(); 
                triggerConfetti(); // Confetti on every result
            }, 1500);
        }

        function renderTeamToss() {
            const { result, isFlipping } = appState.teamToss;
            let message = '';
            let messageClass = 'text-gray-500 font-semibold';
            let coinContent = `<span class="text-2xl sm:text-3xl">1₹</span>`;

            if (result) {
                message = `${result}!`;
                messageClass = `text-3xl sm:text-4xl font-black ${result === 'Heads' ? 'text-indigo-600' : 'text-green-600'} animate-bounce-custom`;
                coinContent = `<span class="drop-shadow-md">${result}</span>`;
            } else if (isFlipping) {
                message = 'Toss in progress...';
                messageClass = 'text-xl text-indigo-500 font-semibold';
                coinContent = `<span class="text-2xl sm:text-3xl">1₹</span>`;
            } else {
                message = 'Tap to toss!';
            }

            return `
                <div class="relative flex flex-col space-y-6 p-8 app-card border border-yellow-200 w-full text-gray-900">
                    
                    <!-- Header Bar -->
                    <div class="flex justify-between items-center border-b pb-3 mb-3">
                        <button id="team-toss-home"
                            class="p-2 btn-icon-home rounded-full transition duration-300 shadow"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        </button>
                        <h2 class="text-2xl font-black text-gray-900 text-center flex-grow">
                            Team Toss
                        </h2>
                        <!-- Spacer to balance Home button after removing Reset button -->
                        <div class="w-[40px] h-[40px]"></div>
                    </div>

                    <!-- Coin Display Area -->
                    <div class="flex justify-center h-48 sm:h-56 items-center">
                        <div id="coin-display"
                            class="w-36 h-36 sm:w-48 sm:h-48 rounded-full flex items-center justify-center 
                            text-3xl sm:text-4xl font-black transition-all duration-300 ${getCoinClass()}"
                        >
                            ${coinContent}
                        </div>
                    </div>
                    
                    <!-- Result Message -->
                    <div class="h-10 text-center">
                        <p class="${messageClass}">${message}</p>
                    </div>

                    <!-- Actions -->
                    <button id="team-toss-button"
                        ${isFlipping ? 'disabled' : ''}
                        class="w-full p-4 font-bold rounded-xl text-xl transition duration-300 transform hover:scale-[1.01] shadow-xl active:border-b-0 ${isFlipping ? 'bg-gray-400 cursor-not-allowed text-gray-700' : 'btn-primary-yellow text-gray-900'}"
                    >
                        ${isFlipping ? 'Tossing...' : 'Toss Coin'}
                    </button>
                </div>
            `;
        }

        function attachTeamTossListeners() {
            document.getElementById('team-toss-home')?.addEventListener('click', () => {
                appState.mode = null;
                // Reset coin state when returning home
                appState.teamToss.result = null;
                appState.teamToss.isFlipping = false;
                renderApp();
            });
            document.getElementById('team-toss-button')?.addEventListener('click', handleToss);
        }

        // --- Singles Toss Logic ---
        function handleSetMaxNumber(value) {
            appState.singlesToss.maxNumber = value;
        }

        function handleInitialGenerate() {
            const max = parseInt(appState.singlesToss.maxNumber, 10);
            
            if (isNaN(max) || max < 2) {
                appState.singlesToss.errorMessage = 'Please enter a valid maximum number (2 or greater) for a draw.';
                renderApp();
                return;
            }
            
            appState.singlesToss.isGenerating = true;
            appState.singlesToss.errorMessage = '';
            appState.singlesToss.drawQueue = [];
            appState.singlesToss.drawnNumbers = [];
            renderApp();

            let numbers = Array.from({ length: max }, (_, i) => i + 1);
            
            // Fisher-Yates shuffle
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }
            
            setTimeout(() => {
                appState.singlesToss.drawQueue = numbers;
                appState.singlesToss.isGenerating = false;
                renderApp();
            }, 800);
        }
        
        function handleDrawNext() {
            if (appState.singlesToss.drawQueue.length === 0) return;
            
            const nextNumber = appState.singlesToss.drawQueue[0];
            
            const newDrawn = [...appState.singlesToss.drawnNumbers, nextNumber];
            const newQueue = appState.singlesToss.drawQueue.slice(1);
            
            const drawIndex = appState.singlesToss.drawnNumbers.length; 
            
            appState.singlesToss.drawnNumbers = newDrawn;
            appState.singlesToss.drawQueue = newQueue;
            renderApp();

            // Trigger confetti for the 1st (index 0), and 2nd (index 1) draw only.
            if (drawIndex === 0 || drawIndex === 1) {
                triggerConfetti();
            }
        }

        function renderSinglesToss() {
            const { maxNumber, drawQueue, drawnNumbers, isGenerating, errorMessage } = appState.singlesToss;
            
            const totalCount = parseInt(maxNumber, 10) || 0;
            const numbersRemaining = drawQueue.length;
            const isDrawComplete = drawnNumbers.length > 0 && numbersRemaining === 0;
            const showInitialInput = drawQueue.length === 0 && drawnNumbers.length === 0;

            let buttonText = 'Generate Random Order';
            let buttonDisabled = isGenerating || (showInitialInput && (!maxNumber || parseInt(maxNumber, 10) < 2)) || isDrawComplete;
            let buttonClass = '';

            if (isGenerating) {
                buttonText = 'Shuffling...';
                buttonClass = 'bg-gray-400 cursor-not-allowed text-gray-700';
            } else if (isDrawComplete) {
                buttonText = 'Draw Complete';
                buttonClass = 'bg-gray-400 cursor-not-allowed text-gray-700';
            } else if (!showInitialInput) {
                buttonText = `Draw Next Number (${numbersRemaining} Remaining)`;
                buttonClass = 'btn-primary-green text-white';
            } else {
                 buttonClass = 'btn-primary-green text-white';
            }
            if (buttonDisabled && !isGenerating) {
                buttonClass = 'bg-gray-400 cursor-not-allowed text-gray-700';
            }


            const drawnHistoryHTML = drawnNumbers.map((num, index) => `
                <div 
                    class="bg-gray-200 text-gray-800 w-8 h-8 flex-shrink-0 flex items-center justify-center 
                            rounded-full text-sm font-semibold shadow-sm"
                >
                    ${num}
                </div>
            `).join('');

            return `
                <div class="relative flex flex-col space-y-6 p-8 app-card border border-green-200 w-full text-gray-900">
                    
                    <!-- Header Bar -->
                    <div class="flex justify-between items-center border-b pb-3 mb-3">
                        <button id="singles-toss-home"
                            class="p-2 btn-icon-home rounded-full transition duration-300 shadow"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        </button>
                        <h2 class="text-2xl font-black text-gray-900 text-center flex-grow">
                            Number Draw
                        </h2>
                        <!-- Spacer to balance Home button after removing Reset button -->
                        <div class="w-[40px] h-[40px]"></div> 
                    </div>

                    <!-- Input Section -->
                    ${showInitialInput ? `
                        <div class="space-y-3">
                            <label for="max-input" class="block text-sm sm:text-base font-medium text-gray-700">
                                Enter Total Number of Slots/Players (N ≥ 2)
                            </label>
                            <input 
                                id="max-input"
                                type="number"
                                min="2"
                                value="${maxNumber}"
                                oninput="handleSetMaxNumber(this.value); renderApp();"
                                placeholder="Max Number (N)"
                                class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-300 text-xl text-gray-900"
                            />
                            ${errorMessage ? `<p class="text-red-500 text-sm italic mt-2">${errorMessage}</p>` : ''}
                        </div>
                    ` : ''}

                    <!-- Primary Action Button -->
                    <button id="singles-toss-button"
                        ${buttonDisabled ? 'disabled' : ''}
                        class="w-full p-4 font-bold rounded-xl text-xl transition duration-300 transform hover:scale-[1.01] shadow-xl active:border-b-0 ${buttonClass}"
                    >
                        ${buttonText}
                    </button>

                    <!-- Current Draw and History Display -->
                    ${drawnNumbers.length > 0 ? `
                        <div class="mt-4 p-4 bg-green-50 rounded-xl border border-green-200 shadow-inner">
                            <h3 class="text-xl font-bold text-green-800 mb-3 text-center">
                                Last Drawn Number
                            </h3>
                            
                            <!-- Current Number Drawn -->
                            <div class="flex justify-center mb-6">
                                <div 
                                    class="bg-green-600 text-white w-24 h-24 sm:w-28 sm:h-28 flex items-center justify-center 
                                            rounded-full font-extrabold text-5xl shadow-xl animate-bounce-in ring-4 ring-green-400"
                                >
                                    ${drawnNumbers[drawnNumbers.length - 1]}
                                </div>
                            </div>
                            
                            <!-- History -->
                            <h4 class="text-sm font-bold text-gray-700 mb-2 border-t pt-3">
                                Drawn Order (${drawnNumbers.length} / ${totalCount})
                            </h4>
                            <div class="flex flex-wrap gap-2 justify-start max-h-24 overflow-y-auto p-2 bg-white rounded-lg border">
                                ${drawnHistoryHTML}
                            </div>
                            
                            ${isDrawComplete ? `
                                <p class="mt-3 text-lg font-bold text-red-600 text-center animate-pulse">
                                    All ${totalCount} numbers have been drawn!
                                </p>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function attachSinglesTossListeners() {
            document.getElementById('singles-toss-home')?.addEventListener('click', () => {
                appState.mode = null;
                // Reset singles state when returning home
                appState.singlesToss.maxNumber = '';
                appState.singlesToss.drawQueue = [];
                appState.singlesToss.drawnNumbers = [];
                appState.singlesToss.errorMessage = '';
                appState.singlesToss.isGenerating = false;
                renderApp();
            });
            
            const button = document.getElementById('singles-toss-button');
            if (button) {
                const showInitialInput = appState.singlesToss.drawQueue.length === 0 && appState.singlesToss.drawnNumbers.length === 0;
                if (showInitialInput) {
                    button.addEventListener('click', handleInitialGenerate);
                } else {
                    button.addEventListener('click', handleDrawNext);
                }
            }
        }


        // Initialize the application on load
        window.onload = renderApp;

    </script>
</body>
</html>
